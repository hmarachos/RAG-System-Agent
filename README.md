# RAG System - Retrieval-Augmented Generation

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ RAG (Retrieval-Augmented Generation) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π OpenAI –∏ GigaChat, –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º –Ω–∞ Qdrant –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–î–≤–µ –≤–µ—Ä—Å–∏–∏ API**: OpenAI –∏ GigaChat (–°–±–µ—Ä)
- **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫**: Qdrant –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ Windows
- **–£–º–Ω—ã–π chunking**: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç –Ω–∞ API
- **–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞**: RAGAS –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏
- **–≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã**: Ground truth –¥–ª—è —Ç–æ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
- **Context managers**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ assistant_api/          # OpenAI –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ app.py             # Flask API —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ vector_store.py    # Qdrant + OpenAI embeddings
‚îÇ   ‚îú‚îÄ‚îÄ rag_pipeline.py    # –û—Å–Ω–æ–≤–Ω–æ–π RAG pipeline
‚îÇ   ‚îú‚îÄ‚îÄ cache.py           # –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ evaluate_ragas.py  # RAGAS –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ evaluate_simple.py # –ü—Ä–æ—Å—Ç–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
‚îÇ   ‚îî‚îÄ‚îÄ data/docs.txt      # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îú‚îÄ‚îÄ assistant_giga/         # GigaChat –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ app.py             # Flask API —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ vector_store.py    # Qdrant + GigaChat embeddings
‚îÇ   ‚îú‚îÄ‚îÄ rag_pipeline.py    # RAG pipeline –¥–ª—è GigaChat
‚îÇ   ‚îú‚îÄ‚îÄ gigachat_client.py # –ö–ª–∏–µ–Ω—Ç GigaChat API
‚îÇ   ‚îî‚îÄ‚îÄ data/docs.txt      # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îú‚îÄ‚îÄ requirements.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example           # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone <repository-url>
cd FINAL_RAG_AGENT_FULL
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω
copy .env.example .env  # Windows
# cp .env.example .env  # Linux/Mac

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ API –∫–ª—é—á–∏
```

## üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–µ–π

### OpenAI API
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [OpenAI Platform](https://platform.openai.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á –≤ —Ä–∞–∑–¥–µ–ª–µ [API Keys](https://platform.openai.com/api-keys)
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`: `OPENAI_API_KEY=your_key_here`

### GigaChat API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [–°–±–µ—Ä Developers](https://developers.sber.ru/portal/products/gigachat)
2. –ü–æ–ª—É—á–∏—Ç–µ RQUID –∏ AUTH_KEY
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```
   GIGACHAT_RQUID=your_rquid_here
   GIGACHAT_AUTH_KEY=your_auth_key_here
   ```

## üöÄ –ó–∞–ø—É—Å–∫

### OpenAI –≤–µ—Ä—Å–∏—è
```bash
cd assistant_api

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
python vector_store.py

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RAG pipeline
python rag_pipeline.py

# –ó–∞–ø—É—Å–∫ Flask API —Å–µ—Ä–≤–µ—Ä–∞
python app.py
```

### GigaChat –≤–µ—Ä—Å–∏—è
```bash
cd assistant_giga

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
python vector_store.py
python rag_pipeline.py

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python app.py
```

## üìä –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü—Ä–æ—Å—Ç–∞—è –æ—Ü–µ–Ω–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
cd assistant_api
python evaluate_simple.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 5 –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∫–ª—é—á–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç—Ç–∞–ª–æ–Ω–Ω—ã–º –æ—Ç–≤–µ—Ç–∞–º

### RAGAS –æ—Ü–µ–Ω–∫–∞ (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è)
```bash
cd assistant_api
python evaluate_ragas.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Faithfulness –∏ Context Precision –æ—Ç RAGAS

## üîß API Endpoints

### POST /query
–û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è RAG –∑–∞–ø—Ä–æ—Å–æ–≤:

```bash
curl -X POST http://localhost:5000/query \
  -H "Content-Type: application/json" \
  -d '{"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ?"}'
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "query": "–ß—Ç–æ —Ç–∞–∫–æ–µ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ?",
  "answer": "–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ - —ç—Ç–æ —Ä–∞–∑–¥–µ–ª –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞...",
  "from_cache": false,
  "context_docs": [...],
  "model": "gpt-4o-mini"
}
```

### GET /stats
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:
```bash
curl http://localhost:5000/stats
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ü–µ–Ω–∫–∏

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫–∞—á–µ—Å—Ç–≤–∞:
- **Faithfulness**: 1.000 ‚úÖ (–∏–¥–µ–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)
- **Relevance**: 0.975 ‚úÖ (–æ—Ç–ª–∏—á–Ω–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)
- **Context Quality**: 0.912 ‚úÖ (—Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- **Clarity**: 1.000 ‚úÖ (–∏–¥–µ–∞–ª—å–Ω–∞—è —è—Å–Ω–æ—Å—Ç—å)
- **Ground Truth Similarity**: 0.975 ‚úÖ (–≤—ã—Å–æ–∫–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç—Ç–∞–ª–æ–Ω—É)

**–û–±—â–∏–π –±–∞–ª–ª**: 0.972/1.000 üü¢ (–æ—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

## üõ° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç context managers –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:

```python
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±
with VectorStore() as vs:
    results = vs.search("query")
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ

with RAGPipeline() as pipeline:
    answer = pipeline.query("question")
# –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–∫—Ä—ã—Ç—ã
```

## üîç Troubleshooting

### PyTorch DLL –æ—à–∏–±–∫–∞ –Ω–∞ Windows
```bash
pip uninstall torch -y
pip install torch==2.0.1 --index-url https://download.pytorch.org/whl/cpu
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Qdrant
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–ø–∫–∞ `qdrant_db` –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç—ã –Ω–µ –∑–∞–Ω—è—Ç—ã –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

### API –∫–ª—é—á–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π –≤ `.env` —Ñ–∞–π–ª–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env` —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch (`git checkout -b feature/amazing-feature`)
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. Push –≤ branch (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª `LICENSE` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é](README.md)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ [Issues](../../issues)
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Issue —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã

---

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
